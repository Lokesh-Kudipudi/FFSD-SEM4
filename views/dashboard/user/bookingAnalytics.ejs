<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <link rel="icon" href="data:," />
    <link
      href="/css/dashboard/user/styles.css"
      rel="stylesheet"
    />
    <link
      href="/css/dashboard/user/navBar.css"
      rel="stylesheet"
    />
    <link
      href="/css/dashboard/user/sidebar.css"
      rel="stylesheet"
    />
    <link
      href="/css/dashboard/user/myTrips.css"
      rel="stylesheet"
    />
    <link href="/css/header.css" rel="stylesheet" />
    <script defer src="/js/header.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <title>Chasing Horizons - Booking Analytics</title>
    <style>
      .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      
      .analytics-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border: 1px solid #e1e5e9;
      }
      
      .analytics-card h3 {
        margin: 0 0 16px 0;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .stat-number {
        font-size: 2.5em;
        font-weight: bold;
        color: #3498db;
        margin: 10px 0;
      }
      
      .stat-label {
        color: #7f8c8d;
        font-size: 14px;
      }
      
      .status-breakdown {
        margin-top: 16px;
      }
      
      .status-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #ecf0f1;
      }
      
      .status-item:last-child {
        border-bottom: none;
      }
      
      .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }
      
      .status-pending { background: #fff3cd; color: #856404; }
      .status-upcoming { background: #d4edda; color: #155724; }
      .status-completed { background: #d1ecf1; color: #0c5460; }
      .status-cancelled { background: #f8d7da; color: #721c24; }
      
      .recent-bookings {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border: 1px solid #e1e5e9;
      }
      
      .recent-booking-item {
        display: flex;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #ecf0f1;
      }
      
      .recent-booking-item:last-child {
        border-bottom: none;
      }
      
      .booking-type-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        font-size: 16px;
        color: white;
      }
      
      .hotel-icon { background: #e74c3c; }
      .tour-icon { background: #27ae60; }
      
      .booking-info {
        flex: 1;
      }
      
      .booking-name {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 4px;
      }
      
      .booking-date {
        font-size: 12px;
        color: #7f8c8d;
      }
      
      .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-top: 20px;
      }
      
      .action-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-decoration: none;
        transition: transform 0.2s ease;
      }
      
      .action-card:hover {
        transform: translateY(-2px);
        text-decoration: none;
        color: white;
      }
      
      .action-card h4 {
        margin: 0 0 8px 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .action-card p {
        margin: 0;
        opacity: 0.9;
        font-size: 14px;
      }
      
      .hotel-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
      .tour-gradient { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    </style>
  </head>

  <body>
    <div class="app-container">
      <header>
        <%- include('../../partials/header.ejs') %>
      </header>

      <div class="main-content">
        <nav class="sidebar">
          <a
            href="/dashboard"
            class="nav-item"
            data-tab="overview"
          >
            <i class="fas fa-globe"></i>
            <span>Overview</span>
          </a>
          <a
            href="/dashboard/bookings/analytics"
            class="nav-item active"
            data-tab="bookings"
          >
            <i class="fas fa-chart-bar"></i>
            <span>Booking Analytics</span>
          </a>
          <a
            href="/dashboard/bookings/hotels"
            class="nav-item"
            data-tab="hotel-bookings"
          >
            <i class="fas fa-bed"></i>
            <span>Hotel Bookings</span>
          </a>
          <a
            href="/dashboard/bookings/tours"
            class="nav-item"
            data-tab="tour-bookings"
          >
            <i class="fas fa-map-marked-alt"></i>
            <span>Tour Bookings</span>
          </a>
          <a
            href="/dashboard/settings"
            class="nav-item"
            data-tab="settings"
          >
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </a>
        </nav>

        <main class="dashboard-myTrips">
          <div class="dashboard-header">
            <h1 class="dashboard-title">Booking Analytics</h1>
            <button
              onclick="window.location.href = `/` "
              class="btn btn-primary"
            >
              <span>+</span> Book New
            </button>
          </div>

          <!-- Error/Message Display -->
          <% if (typeof error !== 'undefined' && error) { %>
          <div class="alert alert-error" style="background-color: #fee; border: 1px solid #fcc; color: #c33; padding: 15px; margin-bottom: 20px; border-radius: 6px;">
            <strong>Error:</strong> <%= error %>
          </div>
          <% } %>

          <% if (analytics) { %>
          <!-- Analytics Overview -->
          <div class="analytics-grid">
            <!-- Total Bookings -->
            <div class="analytics-card">
              <h3><i class="fas fa-calendar-check"></i> Total Bookings</h3>
              <div class="stat-number"><%= analytics.total.count %></div>
              <div class="stat-label">All bookings combined</div>
            </div>

            <!-- Hotel Bookings -->
            <div class="analytics-card">
              <h3><i class="fas fa-bed"></i> Hotel Bookings</h3>
              <div class="stat-number"><%= analytics.hotels.total %></div>
              <div class="stat-label">Hotel reservations</div>
              <div class="status-breakdown">
                <div class="status-item">
                  <span>Pending</span>
                  <span class="status-badge status-pending"><%= analytics.hotels.pending %></span>
                </div>
                <div class="status-item">
                  <span>Upcoming</span>
                  <span class="status-badge status-upcoming"><%= analytics.hotels.upcoming %></span>
                </div>
                <div class="status-item">
                  <span>Completed</span>
                  <span class="status-badge status-completed"><%= analytics.hotels.completed %></span>
                </div>
                <div class="status-item">
                  <span>Cancelled</span>
                  <span class="status-badge status-cancelled"><%= analytics.hotels.cancelled %></span>
                </div>
              </div>
            </div>

            <!-- Tour Bookings -->
            <div class="analytics-card">
              <h3><i class="fas fa-map-marked-alt"></i> Tour Bookings</h3>
              <div class="stat-number"><%= analytics.tours.total %></div>
              <div class="stat-label">Tour reservations</div>
              <div class="status-breakdown">
                <div class="status-item">
                  <span>Pending</span>
                  <span class="status-badge status-pending"><%= analytics.tours.pending %></span>
                </div>
                <div class="status-item">
                  <span>Upcoming</span>
                  <span class="status-badge status-upcoming"><%= analytics.tours.upcoming %></span>
                </div>
                <div class="status-item">
                  <span>Completed</span>
                  <span class="status-badge status-completed"><%= analytics.tours.completed %></span>
                </div>
                <div class="status-item">
                  <span>Cancelled</span>
                  <span class="status-badge status-cancelled"><%= analytics.tours.cancelled %></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Bookings -->
          <div class="recent-bookings">
            <h3 style="margin-bottom: 20px;"><i class="fas fa-clock"></i> Recent Bookings</h3>
            <% if (analytics.recent && analytics.recent.length > 0) { %>
              <% analytics.recent.forEach(booking => { %>
              <div class="recent-booking-item">
                <div class="booking-type-icon <%= booking.type === 'Hotel' ? 'hotel-icon' : 'tour-icon' %>">
                  <i class="fas fa-<%= booking.type === 'Hotel' ? 'bed' : 'map-marked-alt' %>"></i>
                </div>
                <div class="booking-info">
                  <div class="booking-name"><%= booking.itemId?.title || 'Unknown Item' %></div>
                  <div class="booking-date">
                    <%= booking.type %> • 
                    <% if (booking.bookingDetails?.checkInDate) { %>
                      Check-in: <%= new Date(booking.bookingDetails.checkInDate).toLocaleDateString() %>
                    <% } else if (booking.bookingDetails?.startDate) { %>
                      Start: <%= new Date(booking.bookingDetails.startDate).toLocaleDateString() %>
                    <% } else { %>
                      Booked: <%= new Date(booking.createdAt).toLocaleDateString() %>
                    <% } %>
                  </div>
                </div>
                <span class="status-badge status-<%= (booking.bookingDetails?.status || 'pending').replace('cancel', 'cancelled') %>">
                  <%= booking.bookingDetails?.status === 'cancel' ? 'Cancelled' : (booking.bookingDetails?.status || 'Pending') %>
                </span>
              </div>
              <% }); %>
            <% } else { %>
              <div style="text-align: center; padding: 40px; color: #666;">
                <i class="fas fa-calendar-times" style="font-size: 48px; margin-bottom: 16px; color: #ddd;"></i>
                <p>No recent bookings found.</p>
              </div>
            <% } %>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <a href="/dashboard/bookings/hotels" class="action-card hotel-gradient">
              <h4><i class="fas fa-bed"></i> View Hotel Bookings</h4>
              <p>Manage all your hotel reservations in one place</p>
            </a>
            <a href="/dashboard/bookings/tours" class="action-card tour-gradient">
              <h4><i class="fas fa-map-marked-alt"></i> View Tour Bookings</h4>
              <p>Explore your upcoming and past tour experiences</p>
            </a>
          </div>

          <% } else { %>
          <div class="alert alert-info" style="background-color: #e7f3ff; border: 1px solid #b8daff; color: #004085; padding: 15px; margin-bottom: 20px; border-radius: 6px;">
            No booking data available. Start by booking your first hotel or tour!
          </div>
          <% } %>
        </main>
      </div>
    </div>
  </body>
</html>
